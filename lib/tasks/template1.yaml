metadata:
  type: VOD
  name: Standard VOD Workflow

encodings:
  main-encoding:
    properties:
      name: Fish Standard VOD Workflow
      cloudRegion: AWS_US_EAST_1
      encoderVersion: STABLE

    streams:
      video_h264_720p:
        properties:
          inputStreams:
            - inputId: 8b2e245d-0294-42c6-8dba-72d871039b3d
              inputPath: {{input.path}}
          codecConfigId: 66050378-2206-4b7f-92e8-5d2c9636c205
          mode: PER_TITLE_TEMPLATE
      video_h264_1080p:
        properties:
          inputStreams:
            - inputId: 8b2e245d-0294-42c6-8dba-72d871039b3d
              inputPath: {{input.path}}
          codecConfigId: 82524560-03cb-4ef5-9fd9-8855b0cdf59c
          mode: PER_TITLE_TEMPLATE_FIXED_RESOLUTION

    muxings:
      fmp4:
        fmp4_h264:
          properties:
            name: fmp4_h264
            streamConditionsMode: DROP_MUXING
            streams:
              - streamId: $/encodings/main-encoding/streams/video_h264_720p
            outputs:
              - outputId: {{output.id}}
                outputPath: {{output.path}}/vod_streams_encoding/{width}_{bitrate}_{uuid}/
                acl:
                  - permission: PRIVATE
            initSegmentName: init.mp4
            segmentLength: 4
            segmentNaming: seg_%number%.m4s
        fmp4_h264_1080p:
          properties:
            name: fmp4_h264_1080p
            streamConditionsMode: DROP_MUXING
            streams:
              - streamId: $/encodings/main-encoding/streams/video_h264_1080p
            outputs:
              - outputId: {{output.id}}
                outputPath: {{output.path}}/vod_streams_encoding/{bitrate}/
                acl:
                  - permission: PRIVATE
            initSegmentName: init.mp4
            segmentLength: 4
            segmentNaming: seg_%number%.m4s

    start:
      properties:
        encodingMode: THREE_PASS
        perTitle:
          h264Configuration:
            targetQualityCrf: 25
        previewDashManifests:
          - manifestId: $/manifests/dash/defaultapi/default-dash
        vodDashManifests:
          - manifestId: $/manifests/dash/defaultapi/default-dash

manifests:
  dash:
    defaultapi:
      default-dash:
        properties:
          encodingId: $/encodings/main-encoding
          name: Template encoding default DASH manifest
          manifestName: manifest.mpd
          profile: ON_DEMAND
          outputs:
            - outputId: {{output.id}}
              outputPath: {{output.path}}/vod_streams_encoding/
              acl:
                - permission: PRIVATE
          version: V2
